# Pre-commit Hooks Setup

This project uses [pre-commit](https://pre-commit.com/) to ensure code quality and consistency before commits.

## Installation

### Prerequisites

Install pre-commit framework:

```bash
# Using pip
pip install pre-commit

# Using homebrew (macOS)
brew install pre-commit

# Using asdf
asdf plugin add pre-commit
asdf install pre-commit latest
asdf global pre-commit latest
```

### Setup Hooks

Install the git hooks in your local repository:

```bash
cd terraform-proxmox-lxc
pre-commit install
pre-commit install --hook-type commit-msg
```

## Configured Hooks

The following hooks will run automatically before each commit:

### Code Quality
- **trailing-whitespace**: Remove trailing whitespace
- **end-of-file-fixer**: Ensure files end with newline
- **check-yaml**: Validate YAML syntax
- **check-merge-conflict**: Detect merge conflict markers
- **detect-private-key**: Prevent committing private keys

### Terraform Validation
- **terraform_fmt**: Format Terraform files
- **terraform_validate**: Validate Terraform configurations
- **terraform_tflint**: Run TFLint checks
- **terraform_docs**: Auto-generate documentation

### Commit Message
- **commitizen**: Enforce conventional commit format

## Usage

### Automatic Validation

Hooks run automatically on `git commit`:

```bash
git add .
git commit -m "feat: add new feature"
# Hooks run automatically
```

### Manual Validation

Run hooks manually on all files:

```bash
# Run all hooks
pre-commit run --all-files

# Run specific hook
pre-commit run terraform_fmt --all-files
```

### Skip Hooks (Not Recommended)

Only in exceptional cases:

```bash
git commit --no-verify -m "emergency fix"
```

## Troubleshooting

### Hook Failures

If a hook fails:

1. Review the error message
2. Fix the reported issues
3. Stage the fixes: `git add .`
4. Commit again

### Update Hooks

Update to latest hook versions:

```bash
pre-commit autoupdate
```

### Clean Hook Cache

If experiencing issues:

```bash
pre-commit clean
pre-commit install --install-hooks
```

## CI Integration

Pre-commit hooks are also validated in CI pipeline to ensure consistency across all contributors.
